<script>
  function SEND(ws, command) {
    ws.send(JSON.stringify(command));
    return new Promise(resolve => {
      ws.addEventListener('message', function(text) {
        const response = JSON.parse(JSON.stringify(text.data));
        console.log('recieve response')
        console.log(response.id, ': ', command.id)
        if (response.id === command.id) {
          console.log('ok id');
          ws.removeEventListener('message', arguments.callee);
          resolve(response);
        }
      });
    });
  }
  (async () => {
    const ws = new WebSocket('ws://127.0.0.1:9222/devtools/browser/f7aa8f03-1201-4a28-9545-51c8495be3f1')
    console.log('connected!');


    async function SendsCommands() {
      const targetsResponse = await SEND(ws, {
          id: 1000,
          method: 'Target.getTargets',
      });
      console.log('SendsCommands');
      const pageTarget = targetsResponse.result.targetInfos.find(info => info.type === 'page');

      // Attach to the page target.
      const sessionId = (await SEND(ws, {
          id: 1001,
          method: 'Target.attachToTarget',
          params: {
          targetId: pageTarget.targetId,
          flatten: true,
          },
      })).result.sessionId;
      console.log('Get sessionId');

      await ws.send(JSON.stringify({
          id: sessionId,
          method: 'DOM.setAttributeValue',
          params: {
          NodeId: 2,
          Name: 'img',
          Value: 'data:image/gif;base64,R0lGODlhAQABAPAAAP8AAAAAACH5BAQAAAAALAAAAAABAAEAAAICRAEAOw==',
          },
      }));
      console.log("SendsCommands is OK.");
    }
    ws.onopen = SendsCommands;
    ws.onmessage = event => console.log(event.data);
  })();

</script>